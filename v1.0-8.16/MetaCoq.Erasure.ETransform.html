<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">Library MetaCoq.Erasure.ETransform</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Program.Program.html#"><span class="id" title="library">Program</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.ssr.ssreflect.html#"><span class="id" title="library">ssreflect</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.ssr.ssrbool.html#"><span class="id" title="library">ssrbool</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="keyword">Equations</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Equations</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Template</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Template.Transform.html#"><span class="id" title="library">Transform</span></a> <a class="idref" href="MetaCoq.Template.utils.bytestring.html#"><span class="id" title="library">bytestring</span></a> <a class="idref" href="MetaCoq.Template.config.html#"><span class="id" title="library">config</span></a> <a class="idref" href="MetaCoq.Template.utils.html#"><span class="id" title="library">utils</span></a> <a class="idref" href="MetaCoq.Template.BasicAst.html#"><span class="id" title="library">BasicAst</span></a> <a class="idref" href="MetaCoq.Template.common.uGraph.html#"><span class="id" title="library">uGraph</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Template</span> <span class="id" title="keyword">Require</span> <a class="idref" href="MetaCoq.Template.Pretty.html#"><span class="id" title="library">Pretty</span></a> <a class="idref" href="MetaCoq.Template.Environment.html#"><span class="id" title="library">Environment</span></a> <a class="idref" href="MetaCoq.Template.Typing.html#"><span class="id" title="library">Typing</span></a> <a class="idref" href="MetaCoq.Template.WcbvEval.html#"><span class="id" title="library">WcbvEval</span></a> <a class="idref" href="MetaCoq.Template.EtaExpand.html#"><span class="id" title="library">EtaExpand</span></a>.<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Warnings</span> "-notation-overridden".<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.PCUIC</span> <span class="id" title="keyword">Require</span> <a class="idref" href="MetaCoq.PCUIC.PCUICAst.html#"><span class="id" title="library">PCUICAst</span></a> <a class="idref" href="MetaCoq.PCUIC.utils.PCUICAstUtils.html#"><span class="id" title="library">PCUICAstUtils</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#"><span class="id" title="library">PCUICProgram</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICTransform.html#"><span class="id" title="library">PCUICTransform</span></a>.<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Warnings</span> "+notation-overridden".<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.SafeChecker</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.SafeChecker.PCUICErrors.html#"><span class="id" title="library">PCUICErrors</span></a> <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#"><span class="id" title="library">PCUICWfEnvImpl</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure</span> <span class="id" title="keyword">Require</span> <a class="idref" href="MetaCoq.Erasure.EAstUtils.html#"><span class="id" title="library">EAstUtils</span></a> <a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#"><span class="id" title="library">ErasureFunction</span></a> <a class="idref" href="MetaCoq.Erasure.ErasureCorrectness.html#"><span class="id" title="library">ErasureCorrectness</span></a> <a class="idref" href="MetaCoq.Erasure.EPretty.html#"><span class="id" title="library">EPretty</span></a> <a class="idref" href="MetaCoq.Erasure.Extract.html#"><span class="id" title="library">Extract</span></a> <a class="idref" href="MetaCoq.Erasure.EOptimizePropDiscr.html#"><span class="id" title="library">EOptimizePropDiscr</span></a> <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#"><span class="id" title="library">ERemoveParams</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#"><span class="id" title="library">EProgram</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.PCUIC.PCUICAst.html#"><span class="id" title="module">PCUICAst</span></a> (<span class="id" title="var">term</span>) <a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#"><span class="id" title="module">PCUICProgram</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICTransform.html#"><span class="id" title="module">PCUICTransform</span></a> (<span class="id" title="var">eval_pcuic_program</span>) <a class="idref" href="MetaCoq.Erasure.Extract.html#"><span class="id" title="module">Extract</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#"><span class="id" title="module">EProgram</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Erasure.EAst.html#"><span class="id" title="module">EAst</span></a> <a class="idref" href="MetaCoq.Template.Transform.html#Transform"><span class="id" title="module">Transform</span></a> <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#"><span class="id" title="module">ERemoveParams</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.EEnvMap.html#"><span class="id" title="module">EEnvMap</span></a> <a class="idref" href="MetaCoq.Erasure.EGlobalEnv.html#"><span class="id" title="module">EGlobalEnv</span></a> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#"><span class="id" title="module">EWellformed</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="build_wf_env_from_env" class="idref" href="#build_wf_env_from_env"><span class="id" title="definition">build_wf_env_from_env</span></a> {<a id="cf:1" class="idref" href="#cf:1"><span class="id" title="binder">cf</span></a> : <a class="idref" href="MetaCoq.Template.config.html#checker_flags"><span class="id" title="class">checker_flags</span></a>} (<a id="ebf069dbc779b42a15c441a6d39d5f83" class="idref" href="#ebf069dbc779b42a15c441a6d39d5f83"><span class="id" title="binder">Σ</span></a> : <a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#global_env_map"><span class="id" title="record">global_env_map</span></a>) (<a id="9c77acedd153c05882e0fedfeff8f884" class="idref" href="#9c77acedd153c05882e0fedfeff8f884"><span class="id" title="binder">wfΣ</span></a> : <a class="idref" href="MetaCoq.Template.utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf"><span class="id" title="class">PCUICTyping.wf</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#ebf069dbc779b42a15c441a6d39d5f83"><span class="id" title="variable">Σ</span></a> <a class="idref" href="MetaCoq.Template.utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a>) : <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#wf_env"><span class="id" title="record">wf_env</span></a> := <br/>
&nbsp;&nbsp;{| <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#wf_env_referenced"><span class="id" title="projection">wf_env_referenced</span></a> := {| <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#referenced_impl_env"><span class="id" title="projection">referenced_impl_env</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#ebf069dbc779b42a15c441a6d39d5f83"><span class="id" title="variable">Σ</span></a>.(<a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#trans_env_env"><span class="id" title="projection">trans_env_env</span></a>); <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#referenced_impl_wf"><span class="id" title="projection">referenced_impl_wf</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#9c77acedd153c05882e0fedfeff8f884"><span class="id" title="variable">wfΣ</span></a> |} ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#wf_env_map"><span class="id" title="projection">wf_env_map</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#ebf069dbc779b42a15c441a6d39d5f83"><span class="id" title="variable">Σ</span></a>.(<a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#trans_env_map"><span class="id" title="projection">trans_env_map</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#wf_env_map_repr"><span class="id" title="projection">wf_env_map_repr</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#ebf069dbc779b42a15c441a6d39d5f83"><span class="id" title="variable">Σ</span></a>.(<a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#trans_env_repr"><span class="id" title="projection">trans_env_repr</span></a>);<br/>
&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="erase_pcuic_program" class="idref" href="#erase_pcuic_program"><span class="id" title="definition">erase_pcuic_program</span></a> {<a id="guard:4" class="idref" href="#guard:4"><span class="id" title="binder">guard</span></a> : <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#abstract_guard_impl"><span class="id" title="class">abstract_guard_impl</span></a>} (<a id="p:5" class="idref" href="#p:5"><span class="id" title="binder">p</span></a> : <a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#pcuic_program"><span class="id" title="definition">pcuic_program</span></a>) <br/>
&nbsp;&nbsp;(<a id="1bf02b29b8f97bd6c462ad898fb3e03d" class="idref" href="#1bf02b29b8f97bd6c462ad898fb3e03d"><span class="id" title="binder">wfΣ</span></a> : <a class="idref" href="MetaCoq.Template.utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf_ext"><span class="id" title="class">PCUICTyping.wf_ext</span></a> (<span class="id" title="var">H</span> := <a class="idref" href="MetaCoq.Template.config.html#extraction_checker_flags"><span class="id" title="instance">config.extraction_checker_flags</span></a>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:5"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> <a class="idref" href="MetaCoq.Template.utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a>)<br/>
&nbsp;&nbsp;(<a id="wt:8" class="idref" href="#wt:8"><span class="id" title="binder">wt</span></a> : <a class="idref" href="MetaCoq.Template.utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="MetaCoq.Template.utils.MCPrelude.html#cd4bc1b07c8b3bdc9f3bbc7941b56107"><span class="id" title="notation">∑</span></a> <a id="T:7" class="idref" href="#T:7"><span class="id" title="binder">T</span></a><a class="idref" href="MetaCoq.Template.utils.MCPrelude.html#cd4bc1b07c8b3bdc9f3bbc7941b56107"><span class="id" title="notation">,</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#typing"><span class="id" title="inductive">PCUICTyping.typing</span></a> (<span class="id" title="var">H</span> := <a class="idref" href="MetaCoq.Template.config.html#extraction_checker_flags"><span class="id" title="instance">config.extraction_checker_flags</span></a>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:5"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:5"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.2'"><span class="id" title="notation">.2</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#T:7"><span class="id" title="variable">T</span></a> <a class="idref" href="MetaCoq.Template.utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a>) : <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram_env"><span class="id" title="definition">eprogram_env</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="wfe:9" class="idref" href="#wfe:9"><span class="id" title="binder">wfe</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#build_wf_env_from_env"><span class="id" title="definition">build_wf_env_from_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:5"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1.1</span></a> (<a class="idref" href="MetaCoq.Template.utils.MCSquash.html#map_squash"><span class="id" title="lemma">map_squash</span></a> (<a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf_ext_wf"><span class="id" title="lemma">PCUICTyping.wf_ext_wf</span></a> <span class="id" title="var">_</span>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#1bf02b29b8f97bd6c462ad898fb3e03d"><span class="id" title="variable">wfΣ</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="wfext:10" class="idref" href="#wfext:10"><span class="id" title="binder">wfext</span></a> := <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#optim_make_wf_env_ext"><span class="id" title="definition">optim_make_wf_env_ext</span></a> (<span class="id" title="var">guard</span>:=<a class="idref" href="MetaCoq.Erasure.ETransform.html#guard:4"><span class="id" title="variable">guard</span></a>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#wfe:9"><span class="id" title="variable">wfe</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:5"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.2'"><span class="id" title="notation">.2</span></a> <span class="id" title="var">_</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="t:14" class="idref" href="#t:14"><span class="id" title="binder">t</span></a> := <a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#erase"><span class="id" title="definition">ErasureFunction.erase</span></a> (<span class="id" title="var">nor</span>:=<a class="idref" href="MetaCoq.PCUIC.PCUICSN.html#extraction_normalizing"><span class="id" title="instance">PCUICSN.extraction_normalizing</span></a>) <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#optimized_abstract_env_ext_impl"><span class="id" title="definition">optimized_abstract_env_ext_impl</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#wfext:10"><span class="id" title="variable">wfext</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:5"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.2'"><span class="id" title="notation">.2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="0628ce849eb43988c0c2962e2467d294" class="idref" href="#0628ce849eb43988c0c2962e2467d294"><span class="id" title="binder">Σ</span></a> <a id="566bccaf3948029e88abca7911149c0b" class="idref" href="#566bccaf3948029e88abca7911149c0b"><span class="id" title="binder">wfΣ</span></a> ⇒ <span class="id" title="keyword">let</span> '(<a class="idref" href="MetaCoq.Template.utils.MCSquash.html#sq"><span class="id" title="constructor">sq</span></a> <a class="idref" href="MetaCoq.Template.utils.MCPrelude.html#7957360534ce47b451efaf295515cd1d"><span class="id" title="notation">(</span></a><span class="id" title="var">T</span><a class="idref" href="MetaCoq.Template.utils.MCPrelude.html#7957360534ce47b451efaf295515cd1d"><span class="id" title="notation">;</span></a> <span class="id" title="var">ty</span><a class="idref" href="MetaCoq.Template.utils.MCPrelude.html#7957360534ce47b451efaf295515cd1d"><span class="id" title="notation">)</span></a>) := <a class="idref" href="MetaCoq.Erasure.ETransform.html#wt:8"><span class="id" title="variable">wt</span></a> <span class="id" title="tactic">in</span> <a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#iswelltyped"><span class="id" title="constructor">PCUICTyping.iswelltyped</span></a> <span class="id" title="var">ty</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="dd225a58f31205c7251e42f38fa77df9" class="idref" href="#dd225a58f31205c7251e42f38fa77df9"><span class="id" title="binder">Σ'</span></a> := <a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#erase_global_fast"><span class="id" title="definition">ErasureFunction.erase_global_fast</span></a> <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#optimized_abstract_env_impl"><span class="id" title="definition">optimized_abstract_env_impl</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="MetaCoq.Erasure.EAstUtils.html#term_global_deps"><span class="id" title="definition">EAstUtils.term_global_deps</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#t:14"><span class="id" title="variable">t</span></a>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#wfe:9"><span class="id" title="variable">wfe</span></a> (<a class="idref" href="MetaCoq.Erasure.ETransform.html#p:5"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a>.(<a class="idref" href="MetaCoq.PCUIC.PCUICAst.html#PCUICEnvironment.declarations"><span class="id" title="projection">PCUICAst.PCUICEnvironment.declarations</span></a>)) <span class="id" title="var">_</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.Erasure.EEnvMap.html#GlobalContextMap.make"><span class="id" title="definition">EEnvMap.GlobalContextMap.make</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#dd225a58f31205c7251e42f38fa77df9"><span class="id" title="variable">Σ'</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#t:14"><span class="id" title="variable">t</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_glob_fresh"><span class="id" title="lemma">wf_glob_fresh</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#erase_global_fast_wf_glob"><span class="id" title="lemma">ErasureFunction.erase_global_fast_wf_glob</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Obligation</span> <span class="id" title="keyword">Tactic</span> := <span class="id" title="tactic">idtac</span>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.Extract.html#"><span class="id" title="module">Extract</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="erase_program" class="idref" href="#erase_program"><span class="id" title="definition">erase_program</span></a> {<a id="guard:16" class="idref" href="#guard:16"><span class="id" title="binder">guard</span></a> : <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#abstract_guard_impl"><span class="id" title="class">abstract_guard_impl</span></a>} (<a id="p:17" class="idref" href="#p:17"><span class="id" title="binder">p</span></a> : <a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#pcuic_program"><span class="id" title="definition">pcuic_program</span></a>) <br/>
&nbsp;&nbsp;(<a id="wtp:18" class="idref" href="#wtp:18"><span class="id" title="binder">wtp</span></a> : <a class="idref" href="MetaCoq.Template.utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#wt_pcuic_program"><span class="id" title="definition">wt_pcuic_program</span></a> (<span class="id" title="var">cf</span>:=<a class="idref" href="MetaCoq.Template.config.html#extraction_checker_flags"><span class="id" title="instance">config.extraction_checker_flags</span></a>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:17"><span class="id" title="variable">p</span></a> <a class="idref" href="MetaCoq.Template.utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a>) : <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram_env"><span class="id" title="definition">eprogram_env</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Erasure.ETransform.html#erase_pcuic_program"><span class="id" title="definition">erase_pcuic_program</span></a> (<span class="id" title="var">guard</span> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#guard:16"><span class="id" title="variable">guard</span></a>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:17"><span class="id" title="variable">p</span></a> (<a class="idref" href="MetaCoq.Template.utils.MCSquash.html#map_squash"><span class="id" title="lemma">map_squash</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#wtp:18"><span class="id" title="variable">wtp</span></a>) (<a class="idref" href="MetaCoq.Template.utils.MCSquash.html#map_squash"><span class="id" title="lemma">map_squash</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#wtp:18"><span class="id" title="variable">wtp</span></a>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="expanded_erase_program" class="idref" href="#expanded_erase_program"><span class="id" title="lemma">expanded_erase_program</span></a> {<a id="guard:19" class="idref" href="#guard:19"><span class="id" title="binder">guard</span></a> : <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#abstract_guard_impl"><span class="id" title="class">abstract_guard_impl</span></a>} <br/>
&nbsp;&nbsp;(<a id="cf:20" class="idref" href="#cf:20"><span class="id" title="binder">cf</span></a> := <a class="idref" href="MetaCoq.Template.config.html#extraction_checker_flags"><span class="id" title="instance">config.extraction_checker_flags</span></a>) <a id="p:21" class="idref" href="#p:21"><span class="id" title="binder">p</span></a> (<a id="wtp:22" class="idref" href="#wtp:22"><span class="id" title="binder">wtp</span></a> : <a class="idref" href="MetaCoq.Template.utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#wt_pcuic_program"><span class="id" title="definition">wt_pcuic_program</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:21"><span class="id" title="variable">p</span></a> <a class="idref" href="MetaCoq.Template.utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a>) :<br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.PCUIC.PCUICEtaExpand.html#expanded_pcuic_program"><span class="id" title="definition">PCUICEtaExpand.expanded_pcuic_program</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:21"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Erasure.EEtaExpandedFix.html#expanded_eprogram_env"><span class="id" title="definition">EEtaExpandedFix.expanded_eprogram_env</span></a> (<a class="idref" href="MetaCoq.Erasure.ETransform.html#erase_program"><span class="id" title="definition">erase_program</span></a> (<span class="id" title="var">guard</span>:=<a class="idref" href="MetaCoq.Erasure.ETransform.html#guard:19"><span class="id" title="variable">guard</span></a>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:21"><span class="id" title="variable">p</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#wtp:22"><span class="id" title="variable">wtp</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">etaenv</span> <span class="id" title="var">etat</span>]. <span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MetaCoq.Erasure.ETransform.html#erase_program"><span class="id" title="definition">erase_program</span></a>, <a class="idref" href="MetaCoq.Erasure.ETransform.html#erase_pcuic_program"><span class="id" title="definition">erase_pcuic_program</span></a>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#expanded_erase_global_fast"><span class="id" title="lemma">ErasureFunction.expanded_erase_global_fast</span></a>, <span class="id" title="var">etaenv</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#expanded_erase_fast"><span class="id" title="lemma">ErasureFunction.expanded_erase_fast</span></a> (<span class="id" title="var">X_type</span>:=<a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#optimized_abstract_env_impl"><span class="id" title="definition">optimized_abstract_env_impl</span></a>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">etat</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="expanded_eprogram_env_expanded_eprogram_cstrs" class="idref" href="#expanded_eprogram_env_expanded_eprogram_cstrs"><span class="id" title="lemma">expanded_eprogram_env_expanded_eprogram_cstrs</span></a> <a id="p:23" class="idref" href="#p:23"><span class="id" title="binder">p</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Erasure.EEtaExpandedFix.html#expanded_eprogram_env"><span class="id" title="definition">EEtaExpandedFix.expanded_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:23"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_env_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_env_cstrs</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:23"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">move</span>⇒ [] <span class="id" title="var">etaenv</span> <span class="id" title="var">etat</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> /<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.ssr.ssrbool.html#andP"><span class="id" title="lemma">andP</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#isEtaExpFix_env_isEtaExp_env"><span class="id" title="lemma">EEtaExpanded.isEtaExpFix_env_isEtaExp_env</span></a>. <span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EEtaExpandedFix.html#expanded_global_env_isEtaExp_env"><span class="id" title="lemma">EEtaExpandedFix.expanded_global_env_isEtaExp_env</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#isEtaExpFix_isEtaExp"><span class="id" title="lemma">EEtaExpanded.isEtaExpFix_isEtaExp</span></a>. <span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EEtaExpandedFix.html#expanded_isEtaExp"><span class="id" title="lemma">EEtaExpandedFix.expanded_isEtaExp</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="erase_transform" class="idref" href="#erase_transform"><span class="id" title="definition">erase_transform</span></a> {<a id="guard:24" class="idref" href="#guard:24"><span class="id" title="binder">guard</span></a> : <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#abstract_guard_impl"><span class="id" title="class">abstract_guard_impl</span></a>}  : <a class="idref" href="MetaCoq.Template.Transform.html#Transform.t"><span class="id" title="record">Transform.t</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#pcuic_program"><span class="id" title="definition">pcuic_program</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram_env"><span class="id" title="definition">eprogram_env</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICAst.html#term"><span class="id" title="inductive">PCUICAst.term</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.PCUIC.PCUICTransform.html#eval_pcuic_program"><span class="id" title="definition">eval_pcuic_program</span></a> (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram_env"><span class="id" title="definition">eval_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#default_wcbv_flags"><span class="id" title="definition">EWcbvEval.default_wcbv_flags</span></a>) :=<br/>
&nbsp;{| <a class="idref" href="MetaCoq.Template.Transform.html#Transform.name"><span class="id" title="projection">name</span></a> := "erasure";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.pre"><span class="id" title="projection">pre</span></a> <a id="p:25" class="idref" href="#p:25"><span class="id" title="binder">p</span></a> :=  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#wt_pcuic_program"><span class="id" title="definition">wt_pcuic_program</span></a> (<span class="id" title="var">cf</span> := <a class="idref" href="MetaCoq.Template.config.html#extraction_checker_flags"><span class="id" title="instance">config.extraction_checker_flags</span></a>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:25"><span class="id" title="variable">p</span></a> <a class="idref" href="MetaCoq.Template.utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICEtaExpand.html#expanded_pcuic_program"><span class="id" title="definition">PCUICEtaExpand.expanded_pcuic_program</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:25"><span class="id" title="variable">p</span></a> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.transform"><span class="id" title="projection">transform</span></a> <a id="p:26" class="idref" href="#p:26"><span class="id" title="binder">p</span></a> <a id="hp:27" class="idref" href="#hp:27"><span class="id" title="binder">hp</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#erase_program"><span class="id" title="definition">erase_program</span></a> (<span class="id" title="var">guard</span>:=<a class="idref" href="MetaCoq.Erasure.ETransform.html#guard:24"><span class="id" title="variable">guard</span></a>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:26"><span class="id" title="variable">p</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#proj1"><span class="id" title="lemma">proj1</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#hp:27"><span class="id" title="variable">hp</span></a>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.post"><span class="id" title="projection">post</span></a> <a id="p:28" class="idref" href="#p:28"><span class="id" title="binder">p</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.ssr.ssrbool.html#53e4c1e546d9b20e029d981f761726c2"><span class="id" title="notation">[/\</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram_env"><span class="id" title="definition">wf_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">all_env_flags</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:28"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.ssr.ssrbool.html#53e4c1e546d9b20e029d981f761726c2"><span class="id" title="notation">&amp;</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpandedFix.html#expanded_eprogram_env"><span class="id" title="definition">EEtaExpandedFix.expanded_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:28"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.ssr.ssrbool.html#53e4c1e546d9b20e029d981f761726c2"><span class="id" title="notation">]</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.obseq"><span class="id" title="projection">obseq</span></a> <a id="g:29" class="idref" href="#g:29"><span class="id" title="binder">g</span></a> <a id="g':30" class="idref" href="#g':30"><span class="id" title="binder">g'</span></a> <a id="v:31" class="idref" href="#v:31"><span class="id" title="binder">v</span></a> <a id="v':32" class="idref" href="#v':32"><span class="id" title="binder">v'</span></a> := <span class="id" title="keyword">let</span> <a id="4a3db5069015eacb9ec70510dc094686" class="idref" href="#4a3db5069015eacb9ec70510dc094686"><span class="id" title="binder">Σ</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#g:29"><span class="id" title="variable">g</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> <span class="id" title="tactic">in</span> <a class="idref" href="MetaCoq.Erasure.ETransform.html#4a3db5069015eacb9ec70510dc094686"><span class="id" title="variable">Σ</span></a> <a class="idref" href="MetaCoq.Erasure.Extract.html#0343a91997e2a7c4174c89d27a2fb981"><span class="id" title="notation">;;;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="MetaCoq.Erasure.Extract.html#0343a91997e2a7c4174c89d27a2fb981"><span class="id" title="notation">|-</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#v:31"><span class="id" title="variable">v</span></a> <a class="idref" href="MetaCoq.Erasure.Extract.html#0343a91997e2a7c4174c89d27a2fb981"><span class="id" title="notation">⇝</span></a><a class="idref" href="MetaCoq.Erasure.Extract.html#0343a91997e2a7c4174c89d27a2fb981"><span class="id" title="notation">ℇ</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#v':32"><span class="id" title="variable">v'</span></a> |}.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">erase_program</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? <span class="id" title="var">p</span> [<span class="id" title="var">wtp</span> <span class="id" title="var">etap</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <a class="idref" href="MetaCoq.Erasure.ETransform.html#erase_program"><span class="id" title="definition">erase_program</span></a> <span class="id" title="var">eqn</span>:<span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <a class="idref" href="MetaCoq.Erasure.ETransform.html#erase_program"><span class="id" title="definition">erase_program</span></a>, <a class="idref" href="MetaCoq.Erasure.ETransform.html#erase_pcuic_program"><span class="id" title="definition">erase_pcuic_program</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span>. <span class="id" title="tactic">injection</span> <span class="id" title="var">e</span>. <span class="id" title="tactic">intros</span> &lt;- &lt;-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#erase_global_fast_wf_glob"><span class="id" title="lemma">ErasureFunction.erase_global_fast_wf_glob</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#erase_wellformed_fast"><span class="id" title="lemma">ErasureFunction.erase_wellformed_fast</span></a> (<span class="id" title="var">X_type</span>:=<a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#optimized_abstract_env_impl"><span class="id" title="definition">optimized_abstract_env_impl</span></a>)).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> -<span class="id" title="var">e</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.ETransform.html#expanded_erase_program"><span class="id" title="lemma">expanded_erase_program</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="tactic">move</span>⇒ <span class="id" title="var">guard</span> [<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>] <span class="id" title="var">v</span> [[<span class="id" title="keyword">wf</span> [<span class="id" title="var">T</span> <span class="id" title="var">HT</span>]]]. <span class="id" title="tactic">unfold</span> <a class="idref" href="MetaCoq.PCUIC.PCUICTransform.html#eval_pcuic_program"><span class="id" title="definition">eval_pcuic_program</span></a>, <a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram"><span class="id" title="definition">eval_eprogram</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">ev</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <a class="idref" href="MetaCoq.Erasure.ETransform.html#erase_program"><span class="id" title="definition">erase_program</span></a> <span class="id" title="var">eqn</span>:<span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MetaCoq.Erasure.ETransform.html#erase_program"><span class="id" title="definition">erase_program</span></a>, <a class="idref" href="MetaCoq.Erasure.ETransform.html#erase_pcuic_program"><span class="id" title="definition">erase_pcuic_program</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span>. <span class="id" title="tactic">injection</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">intros</span> &lt;- &lt;-.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">e</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">Σ'</span> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#build_wf_env_from_env"><span class="id" title="definition">build_wf_env_from_env</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">ev'</span> :<span class="id" title="keyword">∀</span> <a id="0e91550d34bcb07655b3e35516da888d" class="idref" href="#0e91550d34bcb07655b3e35516da888d"><span class="id" title="binder">Σ0</span></a> : <a class="idref" href="MetaCoq.PCUIC.PCUICAst.html#PCUICEnvironment.global_env"><span class="id" title="record">PCUICAst.PCUICEnvironment.global_env</span></a>, <a class="idref" href="MetaCoq.Erasure.ETransform.html#698abbbe4810bf2acf7196dc109f7495"><span class="id" title="variable">Σ0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">Σ'</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICWcbvEval.html#eval"><span class="id" title="inductive">PCUICWcbvEval.eval</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#698abbbe4810bf2acf7196dc109f7495"><span class="id" title="variable">Σ0</span></a> <span class="id" title="var">t</span> <span class="id" title="var">v</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">subst</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#erase_correct"><span class="id" title="lemma">ErasureFunction.erase_correct</span></a> <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#optimized_abstract_env_impl"><span class="id" title="definition">optimized_abstract_env_impl</span></a> <span class="id" title="var">Σ'</span> <span class="id" title="var">Σ</span><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.2'"><span class="id" title="notation">.2</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MetaCoq.Erasure.EAstUtils.html#term_global_deps"><span class="id" title="definition">EAstUtils.term_global_deps</span></a> <span class="id" title="var">_</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">ev'</span>.<br/>
&nbsp;&nbsp;4:{ <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#erase_global_deps_fast_spec"><span class="id" title="lemma">ErasureFunction.erase_global_deps_fast_spec</span></a>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">all</span>:<span class="id" title="var">trea</span>.<br/>
&nbsp;&nbsp;2:<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Template.Kernames.html#KernameSet.subset_spec"><span class="id" title="lemma">Kernames.KernameSet.subset_spec</span></a>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ev'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">v'</span> [<span class="id" title="var">he</span> [<span class="id" title="var">hev</span>]]]. <span class="id" title="tactic">∃</span> <span class="id" title="var">v'</span>; <span class="id" title="tactic">split</span> ⇒ //.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">sq</span>. <span class="id" title="tactic">exact</span> <span class="id" title="var">hev</span>. <span class="id" title="var">Unshelve</span>. <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
This transformation is the identity on terms but changes the evaluation relation to one
    where fixpoints are not guarded. It requires eta-expanded fixpoints and evaluation 
    to use the guarded fixpoint rule as a precondition. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#"><span class="id" title="module">EWcbvEval</span></a> (<span class="id" title="var">WcbvFlags</span>, <span class="id" title="var">with_prop_case</span>, <span class="id" title="var">with_guarded_fix</span>).<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="guarded_to_unguarded_fix" class="idref" href="#guarded_to_unguarded_fix"><span class="id" title="definition">guarded_to_unguarded_fix</span></a> {<a id="fl:36" class="idref" href="#fl:36"><span class="id" title="binder">fl</span></a> : <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#WcbvFlags"><span class="id" title="class">EWcbvEval.WcbvFlags</span></a>} {<a id="wcon:37" class="idref" href="#wcon:37"><span class="id" title="binder">wcon</span></a> : <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#with_constructor_as_block"><span class="id" title="method">EWcbvEval.with_constructor_as_block</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>} {<a id="efl:38" class="idref" href="#efl:38"><span class="id" title="binder">efl</span></a> : <a class="idref" href="MetaCoq.Erasure.EWellformed.html#EEnvFlags"><span class="id" title="class">EEnvFlags</span></a>} (<a id="wguard:39" class="idref" href="#wguard:39"><span class="id" title="binder">wguard</span></a> : <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#with_guarded_fix"><span class="id" title="method">with_guarded_fix</span></a>) :<br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.t"><span class="id" title="record">Transform.t</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram_env"><span class="id" title="definition">eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram_env"><span class="id" title="definition">eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram_env"><span class="id" title="definition">eval_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#fl:36"><span class="id" title="variable">fl</span></a>) (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram_env"><span class="id" title="definition">eval_eprogram_env</span></a> (<a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#switch_unguarded_fix"><span class="id" title="definition">EWcbvEval.switch_unguarded_fix</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#fl:36"><span class="id" title="variable">fl</span></a>)) :=<br/>
&nbsp;&nbsp;{| <a class="idref" href="MetaCoq.Template.Transform.html#Transform.name"><span class="id" title="projection">name</span></a> := "switching to unguarded fixpoints";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.transform"><span class="id" title="projection">transform</span></a> <a id="p:41" class="idref" href="#p:41"><span class="id" title="binder">p</span></a> <a id="pre:42" class="idref" href="#pre:42"><span class="id" title="binder">pre</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:41"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.pre"><span class="id" title="projection">pre</span></a> <a id="p:40" class="idref" href="#p:40"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram_env"><span class="id" title="definition">wf_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:38"><span class="id" title="variable">efl</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:40"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpandedFix.html#expanded_eprogram_env"><span class="id" title="definition">EEtaExpandedFix.expanded_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:40"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.post"><span class="id" title="projection">post</span></a> <a id="p:43" class="idref" href="#p:43"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram_env"><span class="id" title="definition">wf_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:38"><span class="id" title="variable">efl</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:43"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpandedFix.html#expanded_eprogram_env"><span class="id" title="definition">EEtaExpandedFix.expanded_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:43"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.obseq"><span class="id" title="projection">obseq</span></a> <a id="g:44" class="idref" href="#g:44"><span class="id" title="binder">g</span></a> <a id="g':45" class="idref" href="#g':45"><span class="id" title="binder">g'</span></a> <a id="v:46" class="idref" href="#v:46"><span class="id" title="binder">v</span></a> <a id="v':47" class="idref" href="#v':47"><span class="id" title="binder">v'</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#v':47"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#v:46"><span class="id" title="variable">v</span></a> |}.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">eauto</span>. <span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">move</span>⇒ <span class="id" title="var">fl</span> <span class="id" title="var">wcon</span> <span class="id" title="var">efl</span> <span class="id" title="var">wguard</span> [<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>] <span class="id" title="var">v</span> [<span class="id" title="var">wfp</span> [<span class="id" title="var">etae</span> <span class="id" title="var">etat</span>]]. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">ev</span>]. <span class="id" title="tactic">∃</span> <span class="id" title="var">v</span>. <span class="id" title="tactic">split</span> ⇒ //.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="var">sq</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="var">unshelve</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EEtaExpandedFix.html#eval_opt_to_target"><span class="id" title="lemma">EEtaExpandedFix.eval_opt_to_target</span></a> ⇒ //. <span class="id" title="tactic">auto</span>. 2:<span class="id" title="tactic">apply</span> <span class="id" title="var">wfp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EEtaExpandedFix.html#expanded_global_env_isEtaExp_env"><span class="id" title="lemma">EEtaExpandedFix.expanded_global_env_isEtaExp_env</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EEtaExpandedFix.html#expanded_isEtaExp"><span class="id" title="lemma">EEtaExpandedFix.expanded_isEtaExp</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="rebuild_wf_env" class="idref" href="#rebuild_wf_env"><span class="id" title="definition">rebuild_wf_env</span></a> {<a id="efl:48" class="idref" href="#efl:48"><span class="id" title="binder">efl</span></a>} (<a id="p:49" class="idref" href="#p:49"><span class="id" title="binder">p</span></a> : <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram"><span class="id" title="definition">eprogram</span></a>) (<a id="hwf:50" class="idref" href="#hwf:50"><span class="id" title="binder">hwf</span></a> : <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram"><span class="id" title="definition">wf_eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:48"><span class="id" title="variable">efl</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:49"><span class="id" title="variable">p</span></a>): <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram_env"><span class="id" title="definition">eprogram_env</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.Erasure.EEnvMap.html#GlobalContextMap.make"><span class="id" title="definition">GlobalContextMap.make</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:49"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> (<a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_glob_fresh"><span class="id" title="lemma">wf_glob_fresh</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:49"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#proj1"><span class="id" title="lemma">proj1</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#hwf:50"><span class="id" title="variable">hwf</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:49"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.2'"><span class="id" title="notation">.2</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="rebuild_wf_env_transform" class="idref" href="#rebuild_wf_env_transform"><span class="id" title="definition">rebuild_wf_env_transform</span></a> {<a id="fl:51" class="idref" href="#fl:51"><span class="id" title="binder">fl</span></a> : <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#WcbvFlags"><span class="id" title="class">EWcbvEval.WcbvFlags</span></a>} {<a id="efl:52" class="idref" href="#efl:52"><span class="id" title="binder">efl</span></a>} : <br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.t"><span class="id" title="record">Transform.t</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram"><span class="id" title="definition">eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram_env"><span class="id" title="definition">eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram"><span class="id" title="definition">eval_eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#fl:51"><span class="id" title="variable">fl</span></a>) (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram_env"><span class="id" title="definition">eval_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#fl:51"><span class="id" title="variable">fl</span></a>) :=<br/>
&nbsp;&nbsp;{| <a class="idref" href="MetaCoq.Template.Transform.html#Transform.name"><span class="id" title="projection">name</span></a> := "rebuilding environment lookup table";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.pre"><span class="id" title="projection">pre</span></a> <a id="p:53" class="idref" href="#p:53"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram"><span class="id" title="definition">wf_eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:52"><span class="id" title="variable">efl</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:53"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_cstrs</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:53"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.transform"><span class="id" title="projection">transform</span></a> <a id="p:54" class="idref" href="#p:54"><span class="id" title="binder">p</span></a> <a id="pre:55" class="idref" href="#pre:55"><span class="id" title="binder">pre</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#rebuild_wf_env"><span class="id" title="definition">rebuild_wf_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:54"><span class="id" title="variable">p</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#proj1"><span class="id" title="lemma">proj1</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#pre:55"><span class="id" title="variable">pre</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.post"><span class="id" title="projection">post</span></a> <a id="p:56" class="idref" href="#p:56"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram_env"><span class="id" title="definition">wf_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:52"><span class="id" title="variable">efl</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:56"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_env_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_env_cstrs</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:56"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.obseq"><span class="id" title="projection">obseq</span></a> <a id="g:57" class="idref" href="#g:57"><span class="id" title="binder">g</span></a> <a id="g':58" class="idref" href="#g':58"><span class="id" title="binder">g'</span></a> <a id="v:59" class="idref" href="#v:59"><span class="id" title="binder">v</span></a> <a id="v':60" class="idref" href="#v':60"><span class="id" title="binder">v'</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#v:59"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#v':60"><span class="id" title="variable">v'</span></a> |}.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">fl</span> <span class="id" title="var">efl</span> <span class="id" title="var">input</span> [<span class="id" title="keyword">wf</span> <span class="id" title="var">exp</span>]. <span class="id" title="var">cbn</span>; <span class="id" title="tactic">split</span> ⇒ //.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">fl</span> <span class="id" title="var">efl</span> <span class="id" title="var">input</span> <span class="id" title="var">v</span> [] <span class="id" title="var">ev</span> <span class="id" title="var">p'</span>; <span class="id" title="tactic">∃</span> <span class="id" title="var">v</span>. <span class="id" title="tactic">split</span> ⇒ //.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="remove_params_optimization" class="idref" href="#remove_params_optimization"><span class="id" title="definition">remove_params_optimization</span></a> {<a id="fl:61" class="idref" href="#fl:61"><span class="id" title="binder">fl</span></a> : <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#WcbvFlags"><span class="id" title="class">EWcbvEval.WcbvFlags</span></a>} {<a id="wcon:62" class="idref" href="#wcon:62"><span class="id" title="binder">wcon</span></a> : <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#with_constructor_as_block"><span class="id" title="method">EWcbvEval.with_constructor_as_block</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>}<br/>
&nbsp;&nbsp;(<a id="efl:63" class="idref" href="#efl:63"><span class="id" title="binder">efl</span></a> := <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">all_env_flags</span></a>): <br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.t"><span class="id" title="record">Transform.t</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram_env"><span class="id" title="definition">eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram"><span class="id" title="definition">eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram_env"><span class="id" title="definition">eval_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#fl:61"><span class="id" title="variable">fl</span></a>) (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram"><span class="id" title="definition">eval_eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#fl:61"><span class="id" title="variable">fl</span></a>) :=<br/>
&nbsp;&nbsp;{| <a class="idref" href="MetaCoq.Template.Transform.html#Transform.name"><span class="id" title="projection">name</span></a> := "stripping constructor parameters";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.transform"><span class="id" title="projection">transform</span></a> <a id="p:65" class="idref" href="#p:65"><span class="id" title="binder">p</span></a> <a id="pre:66" class="idref" href="#pre:66"><span class="id" title="binder">pre</span></a> := <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#strip_program"><span class="id" title="definition">ERemoveParams.strip_program</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:65"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.pre"><span class="id" title="projection">pre</span></a> <a id="p:64" class="idref" href="#p:64"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram_env"><span class="id" title="definition">wf_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:63"><span class="id" title="variable">efl</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:64"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_env_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_env_cstrs</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:64"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.post"><span class="id" title="projection">post</span></a> <a id="p:67" class="idref" href="#p:67"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram"><span class="id" title="definition">wf_eprogram</span></a> (<a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#switch_no_params"><span class="id" title="definition">switch_no_params</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:63"><span class="id" title="variable">efl</span></a>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:67"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_cstrs</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:67"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.obseq"><span class="id" title="projection">obseq</span></a> <a id="g:68" class="idref" href="#g:68"><span class="id" title="binder">g</span></a> <a id="g':69" class="idref" href="#g':69"><span class="id" title="binder">g'</span></a> <a id="v:70" class="idref" href="#v:70"><span class="id" title="binder">v</span></a> <a id="v':71" class="idref" href="#v':71"><span class="id" title="binder">v'</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#v':71"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#strip"><span class="id" title="definition">ERemoveParams.strip</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#g:68"><span class="id" title="variable">g</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#v:70"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> |}.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">move</span>⇒ <span class="id" title="var">fl</span> <span class="id" title="var">wcon</span> <span class="id" title="var">efl</span> [<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>] [<span class="id" title="var">wfp</span> <span class="id" title="var">etap</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">ERemoveParams.strip</span>] <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#strip_program_wf"><span class="id" title="lemma">ERemoveParams.strip_program_wf</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#strip_program_expanded"><span class="id" title="lemma">ERemoveParams.strip_program_expanded</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="tactic">move</span>⇒ ? <span class="id" title="var">wcon</span> [<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>] /= <span class="id" title="var">v</span> [[<span class="id" title="var">wfe</span> <span class="id" title="var">wft</span>] <span class="id" title="var">etap</span>] [<span class="id" title="var">ev</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#strip_eval"><span class="id" title="lemma">ERemoveParams.strip_eval</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">ev</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">split</span> ⇒ /= //. <span class="id" title="var">now</span> <span class="id" title="var">sq</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#wellformed_closed_env"><span class="id" title="lemma">wellformed_closed_env</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">move</span>/<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.ssr.ssrbool.html#andP"><span class="id" title="lemma">andP</span></a>: <span class="id" title="var">etap</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#wellformed_closed"><span class="id" title="lemma">wellformed_closed</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">move</span>/<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.ssr.ssrbool.html#andP"><span class="id" title="lemma">andP</span></a>: <span class="id" title="var">etap</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Unshelve</span>. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="remove_params_fast_optimization" class="idref" href="#remove_params_fast_optimization"><span class="id" title="definition">remove_params_fast_optimization</span></a> (<a id="fl:72" class="idref" href="#fl:72"><span class="id" title="binder">fl</span></a> : <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#WcbvFlags"><span class="id" title="class">EWcbvEval.WcbvFlags</span></a>) {<a id="wcon:73" class="idref" href="#wcon:73"><span class="id" title="binder">wcon</span></a> : <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#with_constructor_as_block"><span class="id" title="method">EWcbvEval.with_constructor_as_block</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>}<br/>
&nbsp;&nbsp;(<a id="efl:74" class="idref" href="#efl:74"><span class="id" title="binder">efl</span></a> := <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">all_env_flags</span></a>) :<br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.t"><span class="id" title="record">Transform.t</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram_env"><span class="id" title="definition">eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram"><span class="id" title="definition">eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram_env"><span class="id" title="definition">eval_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#fl:72"><span class="id" title="variable">fl</span></a>) (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram"><span class="id" title="definition">eval_eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#fl:72"><span class="id" title="variable">fl</span></a>) :=<br/>
&nbsp;&nbsp;{| <a class="idref" href="MetaCoq.Template.Transform.html#Transform.name"><span class="id" title="projection">name</span></a> := "stripping constructor parameters (faster?)";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.transform"><span class="id" title="projection">transform</span></a> <a id="p:76" class="idref" href="#p:76"><span class="id" title="binder">p</span></a> <span class="id" title="var">_</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#Fast.strip_env"><span class="id" title="definition">ERemoveParams.Fast.strip_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:76"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#Fast.strip"><span class="id" title="definition">ERemoveParams.Fast.strip</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:76"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:76"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.2'"><span class="id" title="notation">.2</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.pre"><span class="id" title="projection">pre</span></a> <a id="p:75" class="idref" href="#p:75"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram_env"><span class="id" title="definition">wf_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:74"><span class="id" title="variable">efl</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:75"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_env_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_env_cstrs</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:75"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.post"><span class="id" title="projection">post</span></a> <a id="p:77" class="idref" href="#p:77"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram"><span class="id" title="definition">wf_eprogram</span></a> (<a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#switch_no_params"><span class="id" title="definition">switch_no_params</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:74"><span class="id" title="variable">efl</span></a>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:77"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_cstrs</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:77"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.obseq"><span class="id" title="projection">obseq</span></a> <a id="g:78" class="idref" href="#g:78"><span class="id" title="binder">g</span></a> <a id="g':79" class="idref" href="#g':79"><span class="id" title="binder">g'</span></a> <a id="v:80" class="idref" href="#v:80"><span class="id" title="binder">v</span></a> <a id="v':81" class="idref" href="#v':81"><span class="id" title="binder">v'</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#v':81"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#strip"><span class="id" title="definition">ERemoveParams.strip</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#g:78"><span class="id" title="variable">g</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#v:80"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> |}.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">move</span>⇒ <span class="id" title="var">fl</span> <span class="id" title="var">wcon</span> <span class="id" title="var">efl</span> [<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>] [<span class="id" title="var">wfp</span> <span class="id" title="var">etap</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">ERemoveParams.strip</span>] <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#Fast.strip_fast"><span class="id" title="lemma">ERemoveParams.Fast.strip_fast</span></a> -<a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#Fast.strip_env_fast"><span class="id" title="lemma">ERemoveParams.Fast.strip_env_fast</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> (<a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#strip_program_wf"><span class="id" title="lemma">ERemoveParams.strip_program_wf</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">Σ</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">t</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> (<a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#strip_program_expanded"><span class="id" title="lemma">ERemoveParams.strip_program_expanded</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">Σ</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">t</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="tactic">move</span>⇒ ? <span class="id" title="var">wcon</span> [<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>] /= <span class="id" title="var">v</span> [[<span class="id" title="var">wfe</span> <span class="id" title="var">wft</span>] <span class="id" title="var">etap</span>] [<span class="id" title="var">ev</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#Fast.strip_fast"><span class="id" title="lemma">ERemoveParams.Fast.strip_fast</span></a> -<a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#Fast.strip_env_fast"><span class="id" title="lemma">ERemoveParams.Fast.strip_env_fast</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#strip_eval"><span class="id" title="lemma">ERemoveParams.strip_eval</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">ev</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">split</span> ⇒ /= //.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">sq</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#wellformed_closed_env"><span class="id" title="lemma">wellformed_closed_env</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">move</span>/<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.ssr.ssrbool.html#andP"><span class="id" title="lemma">andP</span></a>: <span class="id" title="var">etap</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#wellformed_closed"><span class="id" title="lemma">wellformed_closed</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">move</span>/<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.ssr.ssrbool.html#andP"><span class="id" title="lemma">andP</span></a>: <span class="id" title="var">etap</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Unshelve</span>. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.EOptimizePropDiscr.html#"><span class="id" title="module">EOptimizePropDiscr</span></a> <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#"><span class="id" title="module">EWcbvEval</span></a>.<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="optimize_prop_discr_optimization" class="idref" href="#optimize_prop_discr_optimization"><span class="id" title="definition">optimize_prop_discr_optimization</span></a> {<a id="fl:82" class="idref" href="#fl:82"><span class="id" title="binder">fl</span></a> : <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#WcbvFlags"><span class="id" title="class">WcbvFlags</span></a>} {<a id="wcon:83" class="idref" href="#wcon:83"><span class="id" title="binder">wcon</span></a> : <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#with_constructor_as_block"><span class="id" title="method">with_constructor_as_block</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>} {<a id="efl:84" class="idref" href="#efl:84"><span class="id" title="binder">efl</span></a> : <a class="idref" href="MetaCoq.Erasure.EWellformed.html#EEnvFlags"><span class="id" title="class">EEnvFlags</span></a>} {<a id="hastrel:85" class="idref" href="#hastrel:85"><span class="id" title="binder">hastrel</span></a> : <a class="idref" href="MetaCoq.Erasure.EWellformed.html#has_tRel"><span class="id" title="method">has_tRel</span></a>} {<a id="hastbox:86" class="idref" href="#hastbox:86"><span class="id" title="binder">hastbox</span></a> : <a class="idref" href="MetaCoq.Erasure.EWellformed.html#has_tBox"><span class="id" title="method">has_tBox</span></a>} :<br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.t"><span class="id" title="record">Transform.t</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram_env"><span class="id" title="definition">eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram"><span class="id" title="definition">eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram_env"><span class="id" title="definition">eval_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#fl:82"><span class="id" title="variable">fl</span></a>) (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram"><span class="id" title="definition">eval_eprogram</span></a> (<a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#disable_prop_cases"><span class="id" title="definition">disable_prop_cases</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#fl:82"><span class="id" title="variable">fl</span></a>)) := <br/>
&nbsp;&nbsp;{| <a class="idref" href="MetaCoq.Template.Transform.html#Transform.name"><span class="id" title="projection">name</span></a> := "optimize_prop_discr"; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.transform"><span class="id" title="projection">transform</span></a> <a id="p:88" class="idref" href="#p:88"><span class="id" title="binder">p</span></a> <span class="id" title="var">_</span> := <a class="idref" href="MetaCoq.Erasure.EOptimizePropDiscr.html#optimize_program"><span class="id" title="definition">optimize_program</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:88"><span class="id" title="variable">p</span></a> ; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.pre"><span class="id" title="projection">pre</span></a> <a id="p:87" class="idref" href="#p:87"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram_env"><span class="id" title="definition">wf_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:84"><span class="id" title="variable">efl</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:87"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_env_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_env_cstrs</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:87"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.post"><span class="id" title="projection">post</span></a> <a id="p:89" class="idref" href="#p:89"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram"><span class="id" title="definition">wf_eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:84"><span class="id" title="variable">efl</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:89"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_cstrs</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:89"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.obseq"><span class="id" title="projection">obseq</span></a> <a id="g:90" class="idref" href="#g:90"><span class="id" title="binder">g</span></a> <a id="g':91" class="idref" href="#g':91"><span class="id" title="binder">g'</span></a> <a id="v:92" class="idref" href="#v:92"><span class="id" title="binder">v</span></a> <a id="v':93" class="idref" href="#v':93"><span class="id" title="binder">v'</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#v':93"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MetaCoq.Erasure.EOptimizePropDiscr.html#optimize"><span class="id" title="definition">EOptimizePropDiscr.optimize</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#g:90"><span class="id" title="variable">g</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#v:92"><span class="id" title="variable">v</span></a> |}.<br/>

<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">move</span>⇒ <span class="id" title="var">fl</span> <span class="id" title="var">wcon</span> <span class="id" title="var">efl</span> <span class="id" title="var">hastrel</span> <span class="id" title="var">hastbox</span> [<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>] [<span class="id" title="var">wfp</span> <span class="id" title="var">etap</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EOptimizePropDiscr.html#optimize_program_wf"><span class="id" title="definition">optimize_program_wf</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EOptimizePropDiscr.html#optimize_program_expanded"><span class="id" title="definition">optimize_program_expanded</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="tactic">move</span>⇒ <span class="id" title="var">fl</span> <span class="id" title="var">wcon</span> <span class="id" title="var">efl</span> <span class="id" title="var">hastrel</span> <span class="id" title="var">hastbox</span> [<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>] /= <span class="id" title="var">v</span> [<span class="id" title="var">wfe</span> <span class="id" title="var">wft</span>] [<span class="id" title="var">ev</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EOptimizePropDiscr.html#optimize_correct"><span class="id" title="lemma">EOptimizePropDiscr.optimize_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">ev</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">split</span> ⇒ //. <span class="id" title="tactic">red</span>. <span class="id" title="var">sq</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">wfe</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#wellformed_closed_env"><span class="id" title="lemma">wellformed_closed_env</span></a>, <span class="id" title="var">wfe</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#wellformed_closed"><span class="id" title="lemma">wellformed_closed</span></a>, <span class="id" title="var">wfe</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Unshelve</span>. <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.EInlineProjections.html#"><span class="id" title="library">EInlineProjections</span></a>.<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="inline_projections_optimization" class="idref" href="#inline_projections_optimization"><span class="id" title="definition">inline_projections_optimization</span></a> {<a id="fl:94" class="idref" href="#fl:94"><span class="id" title="binder">fl</span></a> : <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#WcbvFlags"><span class="id" title="class">WcbvFlags</span></a>} {<a id="wcon:95" class="idref" href="#wcon:95"><span class="id" title="binder">wcon</span></a> : <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#with_constructor_as_block"><span class="id" title="method">EWcbvEval.with_constructor_as_block</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>} (<a id="efl:96" class="idref" href="#efl:96"><span class="id" title="binder">efl</span></a> := <a class="idref" href="MetaCoq.Erasure.EInlineProjections.html#switch_no_params"><span class="id" title="definition">switch_no_params</span></a> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">all_env_flags</span></a>)<br/>
&nbsp;&nbsp;{<a id="hastrel:97" class="idref" href="#hastrel:97"><span class="id" title="binder">hastrel</span></a> : <a class="idref" href="MetaCoq.Erasure.EWellformed.html#has_tRel"><span class="id" title="method">has_tRel</span></a>} {<a id="hastbox:98" class="idref" href="#hastbox:98"><span class="id" title="binder">hastbox</span></a> : <a class="idref" href="MetaCoq.Erasure.EWellformed.html#has_tBox"><span class="id" title="method">has_tBox</span></a>} :<br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.t"><span class="id" title="record">Transform.t</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram_env"><span class="id" title="definition">eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram"><span class="id" title="definition">eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram_env"><span class="id" title="definition">eval_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#fl:94"><span class="id" title="variable">fl</span></a>) (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram"><span class="id" title="definition">eval_eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#fl:94"><span class="id" title="variable">fl</span></a>) := <br/>
&nbsp;&nbsp;{| <a class="idref" href="MetaCoq.Template.Transform.html#Transform.name"><span class="id" title="projection">name</span></a> := "primitive projection inlining"; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.transform"><span class="id" title="projection">transform</span></a> <a id="p:100" class="idref" href="#p:100"><span class="id" title="binder">p</span></a> <span class="id" title="var">_</span> := <a class="idref" href="MetaCoq.Erasure.EInlineProjections.html#optimize_program"><span class="id" title="definition">EInlineProjections.optimize_program</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:100"><span class="id" title="variable">p</span></a> ; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.pre"><span class="id" title="projection">pre</span></a> <a id="p:99" class="idref" href="#p:99"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram_env"><span class="id" title="definition">wf_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:96"><span class="id" title="variable">efl</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:99"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_env_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_env_cstrs</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:99"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.post"><span class="id" title="projection">post</span></a> <a id="p:101" class="idref" href="#p:101"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram"><span class="id" title="definition">wf_eprogram</span></a> (<a class="idref" href="MetaCoq.Erasure.EInlineProjections.html#disable_projections_env_flag"><span class="id" title="definition">disable_projections_env_flag</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:96"><span class="id" title="variable">efl</span></a>) <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:101"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_cstrs</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:101"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.obseq"><span class="id" title="projection">obseq</span></a> <a id="g:102" class="idref" href="#g:102"><span class="id" title="binder">g</span></a> <a id="g':103" class="idref" href="#g':103"><span class="id" title="binder">g'</span></a> <a id="v:104" class="idref" href="#v:104"><span class="id" title="binder">v</span></a> <a id="v':105" class="idref" href="#v':105"><span class="id" title="binder">v'</span></a> := <a class="idref" href="MetaCoq.Erasure.ETransform.html#v':105"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MetaCoq.Erasure.EInlineProjections.html#optimize"><span class="id" title="definition">EInlineProjections.optimize</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#g:102"><span class="id" title="variable">g</span></a><a class="idref" href="MetaCoq.Template.utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#v:104"><span class="id" title="variable">v</span></a> |}.<br/>

<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">move</span>⇒ <span class="id" title="var">fl</span> <span class="id" title="var">wcon</span> <span class="id" title="var">efl</span> <span class="id" title="var">hastrel</span> <span class="id" title="var">hastbox</span> [<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>] [<span class="id" title="var">wfp</span> <span class="id" title="var">etap</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EInlineProjections.html#optimize_program_wf"><span class="id" title="definition">optimize_program_wf</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EInlineProjections.html#optimize_program_expanded"><span class="id" title="definition">optimize_program_expanded</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="tactic">move</span>⇒ <span class="id" title="var">fl</span> <span class="id" title="var">wcon</span> <span class="id" title="var">hastrel</span> <span class="id" title="var">hastbox</span> [<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>] /= <span class="id" title="var">v</span> [<span class="id" title="var">wfe</span> <span class="id" title="var">wft</span>] [<span class="id" title="var">ev</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EInlineProjections.html#optimize_correct"><span class="id" title="lemma">EInlineProjections.optimize_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">ev</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">split</span> ⇒ //. <span class="id" title="tactic">red</span>. <span class="id" title="var">sq</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">wfe</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">wfe</span>. <span class="id" title="var">Unshelve</span>. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.EConstructorsAsBlocks.html#"><span class="id" title="library">EConstructorsAsBlocks</span></a>.<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="constructors_as_blocks_transformation" class="idref" href="#constructors_as_blocks_transformation"><span class="id" title="definition">constructors_as_blocks_transformation</span></a> (<a id="efl:106" class="idref" href="#efl:106"><span class="id" title="binder">efl</span></a> := <a class="idref" href="MetaCoq.Erasure.EConstructorsAsBlocks.html#env_flags"><span class="id" title="definition">env_flags</span></a>)<br/>
&nbsp;&nbsp;{<a id="hastrel:107" class="idref" href="#hastrel:107"><span class="id" title="binder">hastrel</span></a> : <a class="idref" href="MetaCoq.Erasure.EWellformed.html#has_tRel"><span class="id" title="method">has_tRel</span></a>} {<a id="hastbox:108" class="idref" href="#hastbox:108"><span class="id" title="binder">hastbox</span></a> : <a class="idref" href="MetaCoq.Erasure.EWellformed.html#has_tBox"><span class="id" title="method">has_tBox</span></a>} :<br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.t"><span class="id" title="record">Transform.t</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram_env"><span class="id" title="definition">eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram"><span class="id" title="definition">eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a> (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram_env"><span class="id" title="definition">eval_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#target_wcbv_flags"><span class="id" title="definition">target_wcbv_flags</span></a>) (<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram"><span class="id" title="definition">eval_eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.EConstructorsAsBlocks.html#block_wcbv_flags"><span class="id" title="definition">block_wcbv_flags</span></a>) := <br/>
&nbsp;&nbsp;{| <a class="idref" href="MetaCoq.Template.Transform.html#Transform.name"><span class="id" title="projection">name</span></a> := "transforming to constuctors as blocks"; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.transform"><span class="id" title="projection">transform</span></a> <a id="p:110" class="idref" href="#p:110"><span class="id" title="binder">p</span></a> <span class="id" title="var">_</span> := <a class="idref" href="MetaCoq.Erasure.EConstructorsAsBlocks.html#transform_blocks_program"><span class="id" title="definition">EConstructorsAsBlocks.transform_blocks_program</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:110"><span class="id" title="variable">p</span></a> ; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.pre"><span class="id" title="projection">pre</span></a> <a id="p:109" class="idref" href="#p:109"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram_env"><span class="id" title="definition">wf_eprogram_env</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#efl:106"><span class="id" title="variable">efl</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:109"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_env_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_env_cstrs</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:109"><span class="id" title="variable">p</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.post"><span class="id" title="projection">post</span></a> <a id="p:111" class="idref" href="#p:111"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.Erasure.EProgram.html#wf_eprogram"><span class="id" title="definition">wf_eprogram</span></a> <a class="idref" href="MetaCoq.Erasure.EConstructorsAsBlocks.html#env_flags_blocks"><span class="id" title="definition">env_flags_blocks</span></a> <a class="idref" href="MetaCoq.Erasure.ETransform.html#p:111"><span class="id" title="variable">p</span></a> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Transform.html#Transform.obseq"><span class="id" title="projection">obseq</span></a> <a id="g:112" class="idref" href="#g:112"><span class="id" title="binder">g</span></a> <a id="g':113" class="idref" href="#g':113"><span class="id" title="binder">g'</span></a> <a id="v:114" class="idref" href="#v:114"><span class="id" title="binder">v</span></a> <a id="v':115" class="idref" href="#v':115"><span class="id" title="binder">v'</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a> |}.<br/>

<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">move</span>⇒ <span class="id" title="var">efl</span> <span class="id" title="var">hastrel</span> <span class="id" title="var">hastbox</span> [<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>] [] [<span class="id" title="var">wftp</span> <span class="id" title="var">wft</span>] /<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.ssr.ssrbool.html#andP"><span class="id" title="lemma">andP</span></a> [<span class="id" title="var">etap</span> <span class="id" title="var">etat</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EConstructorsAsBlocks.html#transform_wf_global"><span class="id" title="lemma">transform_wf_global</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">subst</span> <span class="id" title="var">efl</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EConstructorsAsBlocks.html#transform_wellformed"><span class="id" title="lemma">transform_wellformed</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="tactic">move</span>⇒ <span class="id" title="var">hastrel</span> <span class="id" title="var">hastbox</span> [<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>] /= <span class="id" title="var">v</span> [[<span class="id" title="var">wfe1</span> <span class="id" title="var">wfe2</span>] <span class="id" title="var">wft</span>] [<span class="id" title="var">ev</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">split</span>; [ | <span class="id" title="tactic">eauto</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MetaCoq.Erasure.EEtaExpanded.html#expanded_eprogram_env_cstrs"><span class="id" title="definition">EEtaExpanded.expanded_eprogram_env_cstrs</span></a> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">wft</span>. <span class="id" title="tactic">move</span> ⇒ /<a class="idref" href="http://coq.inria.fr/distrib/V8.16+rc1/stdlib//Coq.ssr.ssrbool.html#andP"><span class="id" title="lemma">andP</span></a> // [<span class="id" title="var">e1</span> <span class="id" title="var">e2</span>]. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.EConstructorsAsBlocks.html#transform_blocks_eval"><span class="id" title="lemma">transform_blocks_eval</span></a>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
